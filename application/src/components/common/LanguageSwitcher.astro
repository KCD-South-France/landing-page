---
import { languages } from '~/i18n/config';
import { getLangFromUrl } from '~/i18n/utils';
import { translatePathToLang } from '~/i18n/routes';
import { findLocalizedBlogPath } from '~/utils/blog';

const lang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;
const languageLinks = await Promise.all(
  Object.entries(languages).map(async ([langCode]) => {
    const locale = langCode as keyof typeof languages;
    const blogAwarePath = await findLocalizedBlogPath(currentPath, locale);

    return {
      langCode,
      href: blogAwarePath || translatePathToLang(currentPath, locale),
    };
  })
);
---

<div class="relative inline-block text-left">
  <div class="flex items-center space-x-2">
    {
      languageLinks.map(({ langCode, href }) => (
        <a
          href={href}
          class:list={[
            'px-3 py-2 text-sm font-medium rounded-md transition-colors',
            lang === langCode
              ? 'bg-primary text-white'
              : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800',
          ]}
          aria-current={lang === langCode ? 'page' : undefined}
        >
          {langCode.toUpperCase()}
        </a>
      ))
    }
  </div>
</div>
