---
import { languages, defaultLang } from '~/i18n/config';
import { translatePathToLang } from '~/i18n/routes';
import { findLocalizedBlogPath } from '~/utils/blog';

const currentPath = Astro.url.pathname;

if (!Astro.site) {
  throw new Error('Astro.site is required for generating language alternates');
}

const baseUrl = Astro.site.origin;
const alternateLinks = await Promise.all(
  Object.keys(languages).map(async (lang) => {
    const locale = lang as keyof typeof languages;
    const blogAwarePath = await findLocalizedBlogPath(currentPath, locale);

    return {
      lang,
      path: blogAwarePath || translatePathToLang(currentPath, locale),
    };
  })
);
const defaultAlternate = alternateLinks.find((entry) => entry.lang === defaultLang);
---

{alternateLinks.map(({ lang, path }) => <link rel="alternate" hreflang={lang} href={`${baseUrl}${path}`} />)}
<link rel="alternate" hreflang="x-default" href={`${baseUrl}${defaultAlternate?.path || `/${defaultLang}`}`} />
